# yaml-language-server: $schema=https://raw.githubusercontent.com/flatpak/flatpak-builder/main/data/flatpak-manifest.schema.json
app-id: io.github.suwayomi.Sorayomi
runtime: org.freedesktop.Platform
sdk: org.freedesktop.Sdk
runtime-version: "22.08"
command: tachidesk-sorayomi
separate-locales: false
finish-args:
  - "--share=network"
  - "--socket=wayland"
  - "--socket=fallback-x11"
modules:
  - name: suwayomi
    buildsystem: simple
    build-commands:
      # - mv ./* /app/
      - mkdir -p /app/bin
      - mkdir -p /app/sorayomi
      - tar xf archive.tar.gz
      - cp -r data /app/sorayomi/
      - cp -r lib /app/sorayomi/
      - cp -r tachidesk_sorayomi /app/sorayomi
      - chmod +x /app/sorayomi/tachidesk_sorayomi
      - ln -s /app/sorayomi/tachidesk_sorayomi /app/bin/tachidesk-sorayomi
      - install -Dm644 io.github.suwayomi.Sorayomi.desktop /app/share/applications/io.github.suwayomi.Sorayomi.desktop
      - install -Dm644 io.github.suwayomi.Sorayomi.metainfo.xml /app/share/appdata/io.github.suwayomi.Sorayomi.metainfo.xml
      - install -Dm644 io.github.suwayomi.Sorayomi.png /app/share/icons/hicolor/512x512/apps/io.github.suwayomi.Sorayomi.png
    sources:
      - type: file
        url: https://github.com/Suwayomi/Tachidesk-Sorayomi/releases/download/0.5.8/tachidesk-sorayomi-0.5.7-linux-x64.tar.gz
        sha256: 53f6b8a90d58092d667abad78c2a386d5d26be68f1b1800ca2b61a619eba4881
        dest-filename: archive.tar.gz
        only-arches:
          - x86_64
        x-checker-data:
          type: json
          url: https://api.github.com/repos/Suwayomi/Tachidesk-Sorayomi/releases/latest
          version-query: ".tag_name"
          url-query: .assets | .[] | select(.name=="tachidesk-sorayomi-" + $version + "-linux-x64.tar.gz") | .browser_download_url
      - type: file
        path: io.github.suwayomi.Sorayomi.desktop
      - type: file
        path: io.github.suwayomi.Sorayomi.png
      - type: file
        path: io.github.suwayomi.Sorayomi.metainfo.xml